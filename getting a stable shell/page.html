<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>getting a stable shell</title>
</head><body><span style="font-size: 12pt"><span style="font-family: Calibri">"<tt>STABILISE YOUR SHELL</tt>" for easier ability in typing commands, you can use the usual upgrade trick (assuming you are running in a bash shell. If you are running within zsh, you will need to have started your netcat listener within a bash subshell... it should be easy enough to re-exploit):<br/>
<br/>
- (on the reverse shell) python3 -c "import pty; pty.spawn('/bin/bash')" &nbsp;OR "/usr/bin/script -qc /bin/bash /dev/null"<br/>
- (press on your keyboard) Ctrl+Z<br/>
<br/>
Examine the current terminal and STTY info so we can force the connected shell to match it. The information needed is the TERM type (“xyz”) and the size of the current TTY (“rows x; columns y”):<br/>
- (on your local host) echo $TERM<br/>
- (on your local host) stty -a<br/>
<br/>
With the shell still backgrounded, now set the current STTY to type raw and tell it to echo the input characters and foreground the shell:<br/>
- (on your local host) stty raw -echo<br/>
- (on your local host) fg<br/>
You will not see your keystrokes -- trust yourself and hit Enter<br/>
<br/>
- (on the reverse shell) reset<br/>
After the reset, the shell should look normal again.<br/>
<br/>
The last step is to set the shell, terminal type and stty size to match our current Kali window (from the info gathered above):<br/>
- (on the reverse shell) export SHELL=bash (or zsh)<br/>
- (on the reverse shell) export TERM=xterm (or <div style="text-align: left">xterm-256,</div>&nbsp;<div style="text-align: left">xterm-256-color</div>)<br/>
- (on the reverse shell) stty rows x columns y</span></span></body></html>